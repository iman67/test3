# Python package
# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'
stages:
- stage: Build
  jobs:
  - job: Build
    continueOnError: true
    steps:
    - script: echo 'Test'
    - task: Bash@3
      inputs:
       targetType: 'inline'
       script: |
         echo "##vso[task.setvariable variable=AppType;]WebJob"
         echo "##[debug] AppType set to WebJob"
         echo "##vso[task.setvariable variable=ispullrequest;]true"
    - task: CmdLine@2
      inputs:
        script: echo Key:'$(AppType)' 
    # This doesn't work, using the conditional insertion, index syntax
      ${{ if eq(variables['AppType'], 'WebJob') }}:
    - task: CmdLine@2
      inputs:
        script: echo Key:'$(AppType)'
        script: echo ispullrequest:'$(ispullrequest)'
    # This also doesn't work, using the conditional insertion, property dereference syntax
      ${{ if eq(variables.AppType, 'WebJob') }}:
    - task: CmdLine@2
      inputs:
        script: echo Key:'$(AppType)'


  - job: BuildDatabase
    dependsOn: Build
    displayName: Database Build
    steps:
      - checkout: none
      - task: CmdLine@2
        condition: and(succeeded(), eq(variables['ispullrequest'], 'true'))
        inputs:
          script: echo ispullrequest:'$(ispullrequest)'
        displayName: Pull request condition value.         